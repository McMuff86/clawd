# 2026-02-04

## Nacht-Session: IntelliPlan Pendenzen-Modul

**Branch:** `nightly/04-02-2026` (pushed to GitHub)

### Was erledigt
- Komplettes Backend f√ºr Pendenzen-Modul implementiert:
  - Migration (026): Tabellen, Enums, Indizes, Trigger
  - Model, Service, Controller, Validator, Routes
  - 40 Tests (alle passing)
- Folgt bestehenden Codebase-Patterns (express-validator, pool.query, toResponse mappers)
- Nutzt bestehende users/projects Tabellen statt neue benutzer/projekte

### Wichtige Entscheidungen
- snake_case in DB (Mix DE/EN), camelCase in API Response
- Soft-Delete via archived_at
- Auto-increment nr pro Projekt (nicht DB-Sequence)
- Eigene pendenzen_historie Tabelle f√ºr field-level tracking
- Sort via Whitelist-Mapping gegen SQL Injection

### Offene Punkte f√ºr Adi
1. Berechtigungen (Monteur/PL/Admin) als n√§chstes oder Frontend first?
2. Express+JWT beibehalten oder Supabase wie in Spec?
3. Nr-Vergabe race-condition-safe machen n√∂tig f√ºr MVP?

---

## Nacht-Session 2: Swiss German TTS ‚Äì Environment Setup

**Projekt:** `~/projects/swiss-german-tts/`

### Was erledigt
- Python 3.12 venv + alle Dependencies (PyTorch 2.6.0 CUDA 12.4, qwen-tts 0.0.5)
- Qwen3-TTS Modelle heruntergeladen (Tokenizer + 1.7B Base)
- LoRA-Tools + Upstream Repos geklont, Patches angewendet
- Flash Attention kompiliert (ABI-Issue ‚Üí SDPA Fallback)
- **3 erfolgreiche TTS-Tests** (deutsch + schweizerdeutsch Text)
  - Model: 3.9 GB VRAM, 4.1 GB Peak
  - Inference: 14-17s pro Satz
- 4 Swiss German Speech Corpora recherchiert:
  - SwissDial (ETH): 3h/Dialekt, frei f√ºr Forschung
  - STT4SG-350: 343h, Lizenz n√∂tig
  - SDS-200: 200h, Lizenz n√∂tig
  - SwissGPC: 7765h Pipeline (GitHub)

### Offene Punkte f√ºr Adi
1. SwissDial JotForm ausf√ºllen ‚Üí https://form.jotform.com/223344961502048
2. `sudo apt install sox libsox-fmt-all` (Data Prep braucht SoX)
3. Optional: STT4SG-350 Lizenz bei info@swissnlp.org
4. Eigene Stimm-Referenz aufnehmen (5-10 S√§tze, ~30s, 24kHz)

---

## Nacht-Session 3: LocAI ‚Äì Repo-Analyse & Quick Wins

**Repo:** `~/projects/locai` (geklont von github.com/McMuff86/locai)
**Branch:** `nightly/04-02-2026` (pushed to GitHub)

### Was erledigt
- Komplette Repo-Analyse durchgef√ºhrt (Architektur, Code-Qualit√§t, Security, Tests, Docs)
- **`docs/improvement-tasks.md`** erstellt mit 25+ priorisierten Tasks:
  - 3x üî¥ Hoch (Security: fehlende Auth auf 10+ API Routes, Path Traversal, Command Injection)
  - 10x üü° Mittel (Code-Qualit√§t, Tests, Performance, Architektur, Docs)
  - 5x üü¢ Niedrig (Nice-to-Have)
- Quick Wins umgesetzt (2 Commits):
  - 10+ Lint-Warnings gefixt (unused imports, let‚Üíconst, @ts-ignore‚Üí@ts-expect-error)
  - `any` Types durch proper Types ersetzt (templates, searxng, useWebSearch)
  - Stale Closure Bug in `useSettings.loadFromFile` gefixt (via settingsRef)
  - Gef√§hrlichen `console.log` entfernt (loggte Base64-Payloads)
  - Package-Name `mc_agent` ‚Üí `locai` korrigiert
  - README Clone-URL Placeholder ersetzt
  - `.env.example` mit dokumentierten Env-Vars erstellt

### Architektur-Erkenntnisse
- **Tech Stack:** Next.js 15 + React 19 + TypeScript + Tailwind 4 + Shadcn/UI
- **Backend:** Ollama API f√ºr lokale LLMs, SearXNG f√ºr Web-Suche, filesystem-basierte Notes
- **Storage:** localStorage f√ºr Chats (mit Quota-Fallback), Filesystem f√ºr Notes
- **CI:** GitHub Actions (lint, typecheck, test, build)
- **Tests:** Nur 20 Unit-Tests (parser, embeddings, resultSelector) ‚Äì keine API/Hook/Component-Tests
- **Security:** `assertLocalRequest()` existiert, wird aber nur in 2 von 15+ Routes genutzt

### Kritischste Findings
1. **Security:** 10+ API Routes ohne Auth-Check ‚Äì `/api/comfyui/gallery/delete` kann Dateien l√∂schen
2. **Path Traversal:** Gallery + Notes akzeptieren beliebige Pfade ohne Sanitization
3. **Command Injection:** ComfyUI Launch mit `shell: true` und User-Input
4. **Test-Coverage:** 0% f√ºr API Routes, Hooks und Komponenten

### Offene Punkte f√ºr Adi
1. Security-Fixes priorisieren (SEC-1 bis SEC-3) ‚Äì besonders wenn remote erreichbar
2. `docs/improvement-tasks.md` durchgehen und Priorit√§ten best√§tigen
3. ConversationSidebar Refactoring (543 Zeilen) als n√§chstes Sprint-Item?
4. Supabase Dependency ‚Äì behalten oder entfernen bis genutzt?
